<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®—æ³•å¯è§†åŒ–æ™ºèƒ½å­¦ä¹ å¹³å°</title>

  <!-- æ ·å¼è¡¨ -->
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="Code/editor.css">
  <link rel="stylesheet" href="AnimatedArea/visualizer.css">
  
  <!-- AIèŠå¤©çª—å£æ ·å¼ -->
  <link rel="stylesheet" href="Ai/ai-chat.css">
  <!-- xterm.js CSS -->
  <link rel="stylesheet" href="lib/xterm-latest/xterm.css">

  <!-- åŸºç¡€åº“ -->
  <script src="lib/vue.js"></script>
  <script src="lib/xterm-latest/xterm.js"></script>
  <script src="lib/xterm-latest/xterm-addon-fit.js"></script>

  <!-- å…¨å±€xtermé€‚é…å™¨ -->
  <script>
    // ç¡®ä¿FitAddonå…¨å±€å¯ç”¨
    window.FitAddon = window.FitAddon || {};
    if (typeof window.FitAddon.FitAddon === 'undefined' && typeof FitAddon !== 'undefined') {
      window.FitAddon.FitAddon = FitAddon;
    }
  </script>

  <!-- Monacoç¼–è¾‘å™¨åŠ è½½å™¨ -->
  <script>
    var require = {
      paths: {
        'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.36.1/min/vs'
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.36.1/min/vs/loader.js"></script>

  <!-- æ ¸å¿ƒåŠŸèƒ½æ¨¡å— -->
  <script src="Code/algorithmCodeExamples.js"></script>
  <script src="AnimatedArea/visualizer.js"></script>
  <!-- æ·»åŠ é“¾è¡¨åŠ¨ç”»å™¨è„šæœ¬ -->
  <!-- <script src="AnimatedArea/dataStructures/LinkedList/LinkedListAnimator.js"></script> -->

  <!-- ç»ˆç«¯å’Œé¢æ¿ç®¡ç† -->
  <script src="Code/terminal/basePanelManager.js"></script>
  <script src="Code/terminal/tabPanelManager.js"></script>
  <script src="Code/terminal/outputPanelManager.js"></script>
  <script src="Code/terminal/problemsPanelManager.js"></script>
  <script src="Code/terminal/debugPanelManager.js"></script>
  <script src="Code/terminal/terminal-manager.js"></script>

  <!-- ç¼–è¾‘å™¨å’Œç»ˆç«¯ -->
  <script src="Code/monacoEditor.js"></script>
  <script src="Code/terminal/monacoValidator.js"></script>
  <script src="Code/aiPredictor/aiCodePredictor.js"></script>

  <!-- AIç›¸å…³åŠŸèƒ½ -->
  <script src="Ai/ai-api.js"></script>
  <script src="Ai/ai-chat.js"></script>

  <!-- Markdownè½¬æ¢å™¨ -->
  <script src="lib/markdownConverter.js"></script>

  <!-- ä¸»åº”ç”¨è„šæœ¬ï¼ˆæœ€ååŠ è½½ï¼‰ -->
  <script src="script.js"></script>

  <!-- å¼•å¯¼ç»„ä»¶ -->
  <!-- <script src="TourGuide/index.js"></script>    -->
</head>
<body>
  <div id="app">
    <header class="app-header"  >
      <h1>ç®—æ³•å¯è§†åŒ–æ™ºèƒ½å­¦ä¹ å¹³å°</h1>
    </header>
    <div class="toolbar">
      <div class="language-selector">
        <label for="language-select">è¯­è¨€:</label>
        <select id="language-select" v-model="editorSettings.language" @change="changeEditorLanguage($event.target.value)">
          <option value="cpp" selected>C/C++</option>
          <option value="python">Python</option>
        </select>
      </div>

      <div class="theme-selector">
        <label for="theme-selector">ä¸»é¢˜:</label>
        <select id="theme-selector" v-model="editorSettings.theme" @change="changeEditorTheme($event.target.value)">
          <option value="vs">æµ…è‰²</option>
          <option value="vs-dark">æ·±è‰²</option>
          <option value="hc-black">é«˜å¯¹æ¯”åº¦</option>
        </select>
      </div>

      <button class="run-button" @click="runCode">
        <span class="run-icon">â–¶</span> è¿è¡Œä»£ç 
      </button>

      <!-- å¯è§†åŒ–æ§åˆ¶åŒºåŸŸ - ä¼˜åŒ–æ’ç‰ˆ -->
      <div class="visualization-controls">
        <!-- æ–°å¢é‡æ„æŒ‰é’® -->
        <button
          class="control-btn reset-btn"
          @click="resetAnimation"
          :disabled="!hasStarted && !isAnimationComplete"
          title="é‡æ–°åŠ è½½åŠ¨ç”»"
        >
          <span class="control-icon">â†º</span>
          é‡æ„
        </button>

        <button
          class="control-btn play-pause-btn"
          @click="togglePlayPause"
          :class="{ 'playing': isPlaying, 'paused': isPaused }"
        >
          <span class="control-icon">{{ isPlaying ? 'âšâš' : 'â–¶' }}</span>
          {{ isPlaying ? 'æš‚åœ' : 'å¼€å§‹' }}
        </button>

        <button
          class="control-btn prev-btn"
          @click="stepBackward"
          :disabled="!hasStarted || isPlaying || isAnimationComplete || currentAnimationStep <= 0"
        >
          <span class="control-icon">â®</span>
          ä¸Šä¸€æ­¥
        </button>

        <!-- è¿›åº¦æ¡ç§»åŠ¨åˆ°è¿™é‡Œï¼Œä¸Šä¸€æ­¥å’Œä¸‹ä¸€æ­¥æŒ‰é’®ä¹‹é—´ -->
        <div class="progress-container">
          <div class="progress-bar" :style="{ width: progress + '%' }"></div>
          <div class="step-counter" v-if="animationSteps.length > 0">{{ currentAnimationStep }}/{{ animationSteps.length }}</div>
        </div>

        <button
          class="control-btn step-btn next-btn"
          @click="stepForward"
          :disabled="!hasStarted || isPlaying || isAnimationComplete"
        >
          <span class="control-icon">â­</span>
          ä¸‹ä¸€æ­¥
        </button>

        <div class="speed-control">
          <label for="speed-slider">é€Ÿåº¦:</label>
          <select id="speed-slider" v-model="animationSpeed" @change="speedChanged">
            <option value="0.25">0.25x</option>
            <option value="0.5">0.5x</option>
            <option value="0.75">0.75x</option>
            <option value="1.0">1.0x</option>
            <option value="1.5">1.5x</option>
            <option value="2.0">2.0x</option>
            <option value="3.0">3.0x</option>
          </select>
        </div>
      </div>
    </div>



    <main class="app-container">
      <!-- ä»£ç åŒºåŸŸ -->
      <div class="code-area" :class="{ 'panel-hidden': !isPanelVisible }">
         <!-- æ·»åŠ æ–‡ä»¶æ ‡ç­¾æ  -->
    <div class="file-tabs">
      <div class="tab-list">
        <div
          v-for="tab in fileTabs"
          :key="tab.id"
          class="file-tab"
          :class="{ active: tab.active }"
          @click="switchFileTab(tab.id)"
          @dblclick="handleTabDblClick(tab.id)"
          :title="tab.id === 1 ? 'ç¤ºä¾‹ä»£ç  - ç‚¹å‡»æŸ¥çœ‹ä»£ç æ ·ä¾‹' : 'ç®—æ³•æ–‡æ¡£ - ç‚¹å‡»æŸ¥çœ‹ç®—æ³•è¯¦ç»†è¯´æ˜'"
        >
          <span class="tab-icon" :class="tab.icon">{{ tab.icon === 'js-icon' ? 'JS' : 'âŸ¨âŸ©' }}</span>
          <span class="tab-name">{{ tab.name }}</span>
          <button class="tab-close" v-if="fileTabs.length > 1" @click.stop="closeFileTab(tab.id)">Ã—</button>
        </div>
        <div class="tab-actions">
          <button class="new-tab-btn" title="æ–°å»ºæ–‡ä»¶" @click="createNewFileTab">+</button>
        </div>
      </div>
    </div>
        <!-- ç¼–è¾‘å™¨å®¹å™¨ -->
        <div id="monaco-editor-container" class="editor-container" v-show="activeFileTab === 1"></div>

        <!-- æ ‡ç­¾2çš„å†…å®¹ - ç®—æ³•æ–‡æ¡£ -->
        <div class="tab-content" id="tab-content-2" v-show="activeFileTab === 2">
          <div class="tab-placeholder">
            <h2>{{ fileTabs.find(tab => tab.id === 2)?.name }}</h2>
            <div class="markdown-content">
              <!-- ç®—æ³•æ–‡æ¡£å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
              <p>è¯·é€‰æ‹©ä¸€ä¸ªç®—æ³•ï¼ŒæŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£è¯´æ˜ã€‚</p>
            </div>
          </div>
        </div>

        <!-- å…¶ä»–æ–°æ ‡ç­¾çš„å†…å®¹ -->
        <div class="tab-content" id="tab-content-other" v-show="activeFileTab > 2">
          <div class="tab-placeholder">
            <h2>{{ fileTabs.find(tab => tab.id === activeFileTab)?.name }}</h2>
            <p>è¿™æ˜¯æ–°å»ºæ ‡ç­¾çš„å†…å®¹åŒºåŸŸã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è‡ªå®šä¹‰å†…å®¹æˆ–ç¼–è¾‘ç›¸å…³ä»£ç ã€‚</p>
          </div>
        </div>

        <!-- è¾“å‡ºåŒºåŸŸ (VSCodeé£æ ¼) -->
        <div class="output-area" v-show="activeFileTab === 1">
          <!-- æ ‡ç­¾é¡µå’Œæ“ä½œæŒ‰é’® -->
          <div class="panel-header">
            <div class="panel-tabs">
              <div class="tab" :class="{ active: activeOutputTab === 'terminal' }" @click="switchTab('terminal')">
                ç»ˆç«¯
              </div>
              <div class="tab" :class="{ active: activeOutputTab === 'result' }" @click="switchTab('result')">
                è¾“å‡º
              </div>
              <div class="tab" :class="{ active: activeOutputTab === 'problems' }" @click="switchTab('problems')">
                é—®é¢˜
              </div>
              <div class="tab" :class="{ active: activeOutputTab === 'debug' }" @click="switchTab('debug')" style="display: none;">
                è°ƒè¯•æ§åˆ¶å°
              </div>
            </div>

            <!-- ç»ˆç«¯æ“ä½œæŒ‰é’® -->
            <div class="tab-actions">
              <button class="action-btn" title="æœ€å¤§åŒ–" @click="toggleMaximizePanel">
                <span class="action-icon">â–²</span>
              </button>
              <button class="action-btn" title="å…³é—­" @click="togglePanelVisibility">
                <span class="action-icon">âœ•</span>
              </button>
            </div>
          </div>

          <!-- è¾“å‡ºå†…å®¹ -->
          <div class="output-content">
            <!-- ç»ˆç«¯å®¹å™¨ -->
            <div id="terminal-container" v-show="activeOutputTab === 'terminal'" class="terminal-panel content-panel"></div>

            <!-- è¾“å‡ºé¢æ¿ -->
            <div class="output-panel content-panel" v-show="activeOutputTab === 'result'">
              <div class="terminal-toolbar">
                <div class="toolbar-actions">
                  <button class="action-btn" title="æ¸…é™¤è¾“å‡º" @click="clearOutput">
                    <span class="action-icon">ğŸ—‘ï¸</span>
                  </button>
                  <button class="action-btn" :class="{'toggled': isOutputScrollLocked}" title="åˆ‡æ¢æ»šåŠ¨é”å®š" @click="toggleOutputScrollLock">
                    <!-- <span class="action-icon">ğŸ”’</span> -->
                  </button>
                </div>
              </div>
              <div class="output">{{ output }}</div>
            </div>

            <!-- é—®é¢˜é¢æ¿ -->
            <div class="problems-panel content-panel" v-show="activeOutputTab === 'problems'">
              <div class="problems-toolbar">
                <div class="filter-container">
                  <input
                    type="text"
                    class="filter-input"
                    placeholder="ç­›é€‰é—®é¢˜..."
                    v-model="problemsFilter"
                  >
                </div>
                <div class="toolbar-actions">
                  <button class="action-btn" title="æ¸…é™¤æ‰€æœ‰é—®é¢˜" @click="clearProblems">
                    <!-- <span class="action-icon">ğŸ—‘ï¸</span> -->
                  </button>
                  <button class="action-btn" title="æŠ˜å æ‰€æœ‰" @click="collapseAllProblems">
                    <span class="action-icon">â†‘â†“</span>
                  </button>
                </div>
              </div>
              <div class="problems-list">
                <div v-for="problem in problems" :key="problem.message + ':' + problem.line" class="problem-item" :class="problem.severity">
                  <div class="problem-severity" :class="problem.severity">{{ problem.severity === 'error' ? 'Ã—' : '!' }}</div>
                  <div class="problem-message">{{ problem.message }}</div>
                  <div class="problem-location">{{ problem.file }}:{{ problem.line }}</div>
                </div>
                <div v-if="problems.length === 0" class="no-problems">
                  ç›®å‰æ²¡æœ‰å‘ç°é—®é¢˜
                </div>
              </div>
            </div>

            <!-- è°ƒè¯•æ§åˆ¶å° -->
            <div class="debug-panel content-panel" v-show="activeOutputTab === 'debug'">
              <div class="debug-toolbar">
                <div class="toolbar-actions">
                  <select class="debug-level-select">
                    <option value="all">æ‰€æœ‰æ¶ˆæ¯</option>
                    <option value="warning">è­¦å‘Š</option>
                    <option value="error">é”™è¯¯</option>
                  </select>
                  <button class="action-btn" title="æ¸…é™¤æ§åˆ¶å°" @click="clearOutput">
                    <span class="action-icon">ğŸ—‘ï¸</span>
                  </button>
                </div>
              </div>
              <div class="debug-content">
                <div class="debug-info">
                  æŒ‰ F5 å¼€å§‹è°ƒè¯•ï¼Œæˆ–å•å‡»å·¥å…·æ ä¸Šçš„ "å¼€å§‹è°ƒè¯•" æŒ‰é’®
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ç®—æ³•å¯è§†åŒ–åŒºåŸŸ -->
      <div class="visualizer-panel" >
        <div class="algorithm-selection">
          <h3>é€‰æ‹©ç®—æ³•</h3>
          <div class="algorithm-categories">
            <div v-for="(algorithms, category) in algorithms" :key="category" class="algorithm-category" :class="{ 'folded': isCategoryFolded(category) }">
              <div class="category-header" @click="toggleCategory(category)">
                <h4>{{ category }}</h4>
                <span class="fold-icon">â–¼</span>
              </div>
              <ul class="algorithm-list">
                <li
                  v-for="algorithm in algorithms"
                  :key="algorithm.id"
                  :class="{ active: selectedAlgorithm === algorithm.id }"
                  @click="selectAlgorithm(algorithm.id)"
                >
                  {{ algorithm.name }}
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="visualization-area">
          <canvas id="algorithmCanvas" width="600" height="400" style="width:100%; height:600px"></canvas>
          <div class="legend" v-if="selectedAlgorithm && getAlgorithmType(selectedAlgorithm) === 'sort'">
            <div class="legend-item">
              <div class="legend-color" :style="{ backgroundColor: getColorForState('base') }"></div>
              <div class="legend-label">åˆå§‹çŠ¶æ€</div>
            </div>
            <div class="legend-item">
              <div class="legend-color" :style="{ backgroundColor: getColorForState('comparing') }"></div>
              <div class="legend-label">æ¯”è¾ƒå…ƒç´ </div>
            </div>
            <div class="legend-item">
              <div class="legend-color" :style="{ backgroundColor: getColorForState('swapping') }"></div>
              <div class="legend-label">äº¤æ¢å…ƒç´ </div>
            </div>
            <div class="legend-item">
              <div class="legend-color" :style="{ backgroundColor: getColorForState('sorted') }"></div>
              <div class="legend-label">å·²æ’åº</div>
            </div>
          </div>

          <!-- é“¾è¡¨äº¤äº’æ§åˆ¶é¢æ¿ -->
          <div class="legend" v-else-if="selectedAlgorithm === 'linkedList'">
            <div class="linkedlist-controls">
              <div class="linkedlist-input-group">
                <label for="linkedlist-input" class="linkedlist-input-label">è¾“å…¥æ•°å­—:</label>
                <input type="number" id="linkedlist-input" class="linkedlist-input" v-model="linkedListInputValue">
              </div>

              <div class="linkedlist-buttons">
                <button class="linkedlist-btn btn-search" @click="onLinkedListAction('search')">æœç´¢</button>

                <div class="linkedlist-dropdown">
                  <button class="linkedlist-btn btn-insert">æ’å…¥</button>
                  <div class="dropdown-content">
                    <button class="dropdown-item" @click="onLinkedListAction('insertHead')">å¤´éƒ¨æ’å…¥</button>
                    <button class="dropdown-item" @click="onLinkedListAction('insertTail')">å°¾éƒ¨æ’å…¥</button>
                    <button class="dropdown-item" @click="onLinkedListAction('insertAt')">æŒ‡å®šä½ç½®æ’å…¥</button>
                  </div>
                </div>

                <div class="linkedlist-dropdown">
                  <button class="linkedlist-btn btn-remove">ç§»é™¤</button>
                  <div class="dropdown-content">
                    <button class="dropdown-item" @click="onLinkedListAction('removeHead')">å¤´éƒ¨ç§»é™¤</button>
                    <button class="dropdown-item" @click="onLinkedListAction('removeTail')">å°¾éƒ¨ç§»é™¤</button>
                    <button class="dropdown-item" @click="onLinkedListAction('removeAt')">æŒ‡å®šä½ç½®ç§»é™¤</button>
                  </div>
                </div>

                <button class="linkedlist-btn btn-reset" @click="onLinkedListAction('reset')">é‡ç½®</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>
</html>
